<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>PojistiToSnadno.cz – Online pojištění snadno a férově</title>
  <meta name="description" content="Sjednejte si úrazové, životní nebo majetkové pojištění jednoduše online s osobním poradcem. Férový přístup a reálné zkušenosti."/>
  <meta name="keywords" content="pojištění online, úrazové pojištění, životní pojištění, majetkové pojištění, kalkulačka pojištění, Šumperk, Jeseníky"/>

  <meta property="og:title" content="PojistiToSnadno.cz – Snadné a férové pojištění online"/>
  <meta property="og:description" content="Online pojištění úrazové, majetkové i životní. Rychlá kalkulace a osobní přístup."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://pojistitosnadno.cz/"/>
  <meta property="og:image" content="https://pojistitosnadno.cz/og-image.jpg"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <link rel="canonical" href="https://pojistitosnadno.cz/"/>
  <link rel="icon" href="favicon.ico" type="image/x-icon"/>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
  :root{
    --paper:#ffffff;
    --ink:#1c1c1c;
    --muted:#6d6d6d;
    --bg:#f6f6f4;
    --gold:#c9b475;      /* zlatavá */
    --gold-dark:#b39f60; /* tmavší odstín */
    --shadow-sm:0 2px 6px rgba(0,0,0,.08);
    --shadow-md:0 10px 24px rgba(0,0,0,.14);
    --radius:16px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:'Raleway',Arial,sans-serif;color:var(--ink);background:var(--bg)}

  /* ===== Header ===== */
  .header{
    position:fixed;top:0;left:0;right:0;height:56px;z-index:1000;
    display:flex;align-items:center;justify-content:space-between;
    padding:0 14px;background:rgba(255,255,255,.9);
    border-bottom:1px solid rgba(0,0,0,.06);
    backdrop-filter:blur(8px) saturate(140%);
  }
  .brand{display:flex;align-items:center;gap:10px;font-weight:800}
  .brand__logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--gold),#ffe87a)}
  .brand__name{white-space:nowrap}
  .nav{position:fixed;top:56px;left:0;right:0;transform:translateY(-8px);opacity:0;pointer-events:none;background:#fff;transition:.25s;border-bottom:1px solid rgba(0,0,0,.06)}
  .nav--open{transform:translateY(0);opacity:1;pointer-events:auto}
  .nav ul{margin:0;padding:10px;list-style:none}
  .nav a{display:block;padding:10px;border-radius:10px;text-decoration:none;color:var(--ink);font-weight:700}
  .nav a:hover{background:rgba(0,0,0,.05)}
  .burger{width:40px;height:40px;border:0;background:transparent;cursor:pointer;border-radius:10px;display:grid;place-items:center}
  .burger span,.burger span::before,.burger span::after{content:"";display:block;width:22px;height:2px;background:#000;position:relative;transition:.25s;border-radius:2px}
  .burger span::before{position:absolute;transform:translateY(-6px)}
  .burger span::after{position:absolute;transform:translateY(6px)}
  .burger[aria-expanded="true"] span{background:transparent}
  .burger[aria-expanded="true"] span::before{transform:rotate(45deg)}
  .burger[aria-expanded="true"] span::after{transform:rotate(-45deg)}

  /* ===== Hero ===== */
  .hero{padding-top:56px;position:relative;background:#000;color:#fff}
  .hero__bg::before{content:"";position:absolute;inset:0;background:url('hero-bg.webp') center/cover no-repeat;filter:blur(8px) saturate(110%);opacity:.85}
  .hero__overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.7),rgba(0,0,0,.08))}
  .hero__wrap{position:relative;z-index:2;display:grid;gap:20px;align-items:center;padding:40px 20px}
  .hero__grid{display:grid;grid-template-columns:120px 1fr;gap:20px;align-items:center}
  .hero__portrait img{width:120px;height:120px;border-radius:16px;object-fit:cover;border:2px solid rgba(255,255,255,.7)}
  .btn{display:inline-block;padding:12px 20px;border-radius:12px;font-weight:800;text-decoration:none}
  .btn--primary{background:linear-gradient(180deg,var(--gold),var(--gold-dark));color:#000;box-shadow:var(--shadow-md)}
  .btn--ghost{background:rgba(255,255,255,.2);color:#fff;border:1px solid rgba(255,255,255,.6)}

  /* Override na finální pozadí */
  .hero__bg::before{
    content:"";
    position:absolute;
    inset:0;
    background:url('img/fotouvod.webp') right center / cover no-repeat;
    filter:blur(8px) saturate(110%);
    opacity:.85;
  }

  /* ===== Sections ===== */
  .section{max-width:1140px;margin:0 auto;padding:40px 20px}
  .section h2{margin:0 0 16px}

  /* ===== Služby (ikonové karty) ===== */
  .services{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
  .svc-card{background:#fff;border-radius:14px;padding:16px;display:grid;gap:8px;box-shadow:var(--shadow-sm);transition:transform .2s, box-shadow .2s}
  .svc-card:hover{transform:translateY(-3px);box-shadow:var(--shadow-md)}
  .svc-icon{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--gold),#ffe87a);display:grid;place-items:center}
  .svc-icon svg{width:18px;height:18px}
  .svc-title{font-weight:800}
  .svc-text{color:var(--muted);font-size:.95rem}

  .section-cta{text-align:center;margin-top:18px}

  /* ===== Výběr podle situace (grid karet) ===== */
  .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
  .card{position:relative;border-radius:16px;overflow:hidden;background:#000;aspect-ratio:4/3;box-shadow:var(--shadow-sm);transition:transform .25s, box-shadow .25s}
  .card:hover{transform:translateY(-4px);box-shadow:var(--shadow-md)}
  .card__img{position:absolute;inset:0;background-size:cover;background-position:center;filter:brightness(.82);transition:transform .35s ease,filter .35s ease}
  .card:hover .card__img{transform:scale(1.04);filter:brightness(.95)}
  .card__text{position:absolute;inset:auto 0 0 0;color:#fff;padding:18px;background:linear-gradient(to top,rgba(0,0,0,.55),rgba(0,0,0,0))}
  .card__text h3{margin:0 0 6px}
  .card__text p{margin:0;opacity:.95}

  /* ===== Hodnocení (hvězdičky) ===== */
  #rating-widget{display:grid;gap:10px;align-items:center;max-width:520px}
  #rating-widget .stars{display:flex;gap:8px;font-size:2rem;cursor:pointer;user-select:none}
  #rating-stats{display:flex;gap:10px;align-items:baseline}
  #rating-status{margin-left:auto;color:#6d6d6d}

  /* ===== Kontakt ===== */
  .contact-quick{display:grid;grid-template-columns:1fr;gap:10px;margin-bottom:8px}
  .qi{display:flex;align-items:center;gap:10px;background:#fff;padding:12px 14px;border-radius:12px;box-shadow:var(--shadow-sm)}
  .qi svg{width:18px;height:18px}
  .form{display:grid;gap:10px}
  .form input,.form textarea{width:100%;padding:12px;border-radius:10px;border:1px solid #ccc;font:inherit;background:#fff}
  .form .actions{display:flex;gap:10px;justify-content:center}

  /* ===== Footer ===== */
  footer{background:#efefec;padding:22px 16px;margin-top:28px}
  .footer-wrap{max-width:1140px;margin:0 auto;display:grid;gap:12px}
  .footer-links,.social{display:flex;gap:14px;flex-wrap:wrap}
  .footer-links a,.social a{color:var(--ink);text-decoration:none}
  .footer-links a:hover{text-decoration:underline}

  /* ===== Desktop ===== */
  @media(min-width:960px){
    .header{height:64px;padding:0 22px}
    .burger{display:none}
    .nav{position:static;transform:none;opacity:1;pointer-events:auto;background:transparent;border:0}
    .nav ul{display:flex;gap:8px;padding:0}
    .nav a{padding:10px 12px;border-radius:10px}
    .nav a:hover{background:rgba(0,0,0,.06)}

    .hero__wrap{max-width:1140px;margin:0 auto;padding:64px 24px 96px}
    .hero__grid{grid-template-columns:360px 1fr;gap:22px;align-items:end}
    .hero__portrait img{width:360px;height:460px;border-radius:24px}
    .hero h1{font-size:46px}

    .contact-quick{grid-template-columns:repeat(2,1fr)}
  }

  /* omezení animací */
  @media (prefers-reduced-motion:reduce){
    .nav,.burger span,.burger span::before,.burger span::after,.card__img{transition:none}
  }

  /* ===== Mobilní finetuning header/hero ===== */
  @media (max-width: 640px){
    .header{
      height: 56px;
      padding: 0 12px;
      padding-left: max(12px, env(safe-area-inset-left));
      padding-right: max(12px, env(safe-area-inset-right));
    }
    .brand__name{ font-size: 18px; font-weight: 800; }

    .nav{
      top: 56px;
      max-height: calc(100dvh - 56px);
      overflow: auto;
      background: rgba(255,255,255,.98);
      border-bottom: 1px solid rgba(0,0,0,.08);
      box-shadow: 0 10px 30px rgba(0,0,0,.12);
    }
    body.no-scroll{ overflow: hidden; }

    .hero{ padding-top: 56px; }
    .hero__overlay{
      background: linear-gradient(
        to bottom,
        rgba(0,0,0,.65) 0%,
        rgba(0,0,0,.45) 35%,
        rgba(0,0,0,.20) 100%
      );
    }
    .hero__wrap{ padding: 22px 16px 28px; }
    .hero__grid{
      grid-template-columns: 1fr;
      gap: 14px;
      align-items: start;
    }
    .hero__portrait{
      order: -1;
      display: flex; justify-content: center;
    }
    .hero__portrait img{
      width: 132px; height: 132px;
      border-radius: 16px;
      border: 1.5px solid rgba(255,255,255,.65);
    }

    .hero h1{
      font-size: 32px;
      line-height: 1.12;
      margin: 6px 0 6px;
      letter-spacing: .2px;
    }
    .hero .lead{
      font-size: 1rem;
      line-height: 1.45;
      max-width: 36ch;
      margin: 4px 0 10px;
    }

    .hero .btn{
      width: 100%;
      text-align: center;
      padding: 12px 16px;
    }
    .hero .btn--primary{ box-shadow: 0 8px 20px rgba(0,0,0,.18); }
  }
  </style>
</head>
<body>

<!-- ===== Header ===== -->
<header class="header">
  <div class="brand">
    <div class="brand__logo" aria-hidden="true"></div>
    <div class="brand__name">PojistiToSnadno.cz</div>
  </div>
  <nav class="nav" id="nav" aria-label="Hlavní navigace">
    <ul>
      <li><a href="#o-mne">O mně</a></li>
      <li><a href="#sluzby">Služby</a></li>
      <li><a href="#situace">Podle situace</a></li>
      <li><a href="#hodnoceni">Hodnocení</a></li>
      <li><a href="#kontakt">Kontakt</a></li>
    </ul>
  </nav>
  <button class="burger" id="burger" aria-controls="nav" aria-expanded="false" aria-label="Menu"><span></span></button>
</header>

<!-- ===== Hero ===== -->
<section class="hero" id="o-mne" aria-label="Úvod">
  <div class="hero__bg" aria-hidden="true"></div>
  <div class="hero__overlay" aria-hidden="true"></div>
  <div class="hero__wrap">
    <div class="hero__grid">
      <div class="hero__portrait"><img src="portret.webp" alt="Daniel Verner – pojišťovací poradce"></div>
      <div>
        <h1>Jmenuji se Daniel Verner</h1>
        <p class="lead">Pracuji jako pojišťovací poradce v jedné z největších a nejsilnějších pojišťoven v ČR. Věřím, že férový a lidský přístup je základem dlouhodobé spokojenosti. Kvalitní pojištění je podle mě jistota, která vás podrží ve chvílích, kdy to nejvíce potřebujete.</p>
        <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap">
          <a href="#kontakt" class="btn btn--primary">Nezávazně mě kontaktujte</a>
          <a href="#sluzby" class="btn btn--ghost">Zobrazit služby</a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== Služby: ikonové karty ===== -->
<section class="section" id="sluzby">
  <h2>Služby, které nabízím</h2>
  <div class="services">
    <article class="svc-card">
      <div class="svc-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none"><path d="M12 3l7 3v5c0 5.25-3.5 8.69-7 10-3.5-1.31-7-4.75-7-10V6l7-3z" stroke="#3a3320" stroke-width="1.5"/></svg>
      </div>
      <div class="svc-title">Úrazové a životní pojištění</div>
      <div class="svc-text">Praktická ochrana pro jednotlivce i rodiny.</div>
    </article>
    <article class="svc-card">
      <div class="svc-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none"><path d="M3 11l9-7 9 7" stroke="#3a3320" stroke-width="1.5"/><path d="M5 10v10h14V10" stroke="#3a3320" stroke-width="1.5"/></svg>
      </div>
      <div class="svc-title">Pojištění majetku</div>
      <div class="svc-text">Byt, dům i odpovědnost. K tomu rozsáhlé asistence zdarma.</div>
    </article>
    <article class="svc-card">
      <div class="svc-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none"><path d="M3 13l2-5h14l2 5" stroke="#3a3320" stroke-width="1.5"/><circle cx="7" cy="17" r="2" stroke="#3a3320" stroke-width="1.5"/><circle cx="17" cy="17" r="2" stroke="#3a3320" stroke-width="1.5"/></svg>
      </div>
      <div class="svc-title">Pojištění vozidel i drobných elektrovozítek</div>
      <div class="svc-text">Povinné, havarijní pojištění, připojištění a asistence.</div>
    </article>
    <article class="svc-card">
      <div class="svc-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none"><path d="M12 21c4.97 0 9-4.03 9-9s-4.03-9-9-9-9 4.03-9 9" stroke="#3a3320" stroke-width="1.5"/><path d="M7 21v-4a3 3 0 013-3h4a3 3 0 013 3v4" stroke="#3a3320" stroke-width="1.5"/></svg>
       <div class="svc-text">Hypotéky, úvěry na bydlení</div>
    </article>
  </div>
  <div class="section-cta">
    <a href="#kontakt" class="btn btn--primary">Nezávazně poptat pojištění</a>
  </div>
</section>

<!-- ===== Výběr podle situace (grid) ===== -->
<section class="section" id="situace">
  <h2>Vyberte si pojištění podle situace</h2>
  <div class="grid">
    <a class="card" href="pracovni-neschopnost.html" aria-label="Pracovní neschopnost">
      <span class="card__img" style="background-image:url('PN.webp')"></span>
      <div class="card__text"><h3>Pracovní neschopnost</h3><p>Možnost pojištění pouze pracovní neschopnosti bez dalších připojištění – pro zaměstnance i OSVČ.</p></div>
    </a>
    <a class="card" href="urazovka-doprava.html" aria-label="Úraz v dopravě">
      <span class="card__img" style="background-image:url('traffic_300x300.webp')"></span>
      <div class="card__text"><h3>Úraz v dopravě</h3><p>Úrazovka pouze pro nehody v dopravě – levně a účelně.</p></div>
    </a>
    <a class="card" href="pojisteni-nemovitosti.html" aria-label="Pojištění nemovitosti">
      <span class="card__img" style="background-image:url('img/RD.webp')"></span>
      <div class="card__text"><h3>Nemovitost</h3><p>Dům/byt + odpovědnost. Asistence v ceně.</p></div>
    </a>

    <!-- Pojištění pro zdravotně postižené osoby -->
    <a class="card" href="pojisteni-zdravotnepostizenychosob.html" aria-label="Pojištění pro zdravotně postižené osoby">
      <span class="card__img" style="background-image:url('img/ozppozadi.webp')"></span>
      <div class="card__text">
        <h3>Pojištění pro zdravotně postižené</h3>
        <p>Pojištění asistenčního/vodícího psa a zdravotních pomůcek doma i mimo domov.</p>
      </div>)
    </a>

    <a class="card" href="detske_pojisteni.html" aria-label="Dětské pojištění">
      <span class="card__img" style="background-image:url('flexydeti.webp')"></span>
      <div class="card__text"><h3>Děti</h3><p>Úraz i nemoc. Výhodné sazby.</p></div>
    </a>
    <a class="card" href="zivotni.html" aria-label="Životní pojištění">
      <span class="card__img" style="background-image:url('flexy2.webp')"></span>
      <div class="card__text"><h3>Životní pojištění</h3><p>Komplexní ochrana rodiny i jednotlivců.</p></div>
    </a>
    <a class="card" href="povinneruceni.html?typ=ridic" aria-label="Pojištění vozidel">
      <span class="card__img" style="background-image:url('GL3.webp')"></span>
      <div class="card__text"><h3>Vozidla</h3><p>Povinné i havarijní. Bonusy a asistence.</p></div>
    </a>
    <a class="card" href="rocni-karta.html" aria-label="Roční cestovní karta">
      <span class="card__img" style="background-image:url('letiste.webp')"></span>
      <div class="card__text"><h3>Cestování</h3><p>Roční karta se silnou asistencí.</p></div>
    </a>
    <a class="card" href="SLOVNIK.html" aria-label="Slovník pojmů">
      <span class="card__img" style="background-image:url('slovnik.webp')"></span>
      <div class="card__text"><h3>Slovník pojmů</h3><p>Rychlé vysvětlení, když smlouva mluví „cizí řečí“.</p></div>
    </a>
  </div>
  <div class="section-cta">
    <a href="#kontakt" class="btn btn--primary">Nezávazně poptat pojištění</a>
  </div>
</section>

<!-- ===== Hodnocení ===== -->
<section class="section" id="hodnoceni">
  <h2>Ohodnoťte web</h2>
  <div id="rating-widget">
    <div aria-label="Hvězdičkové hodnocení" role="radiogroup" class="stars" id="stars">
      <button type="button" class="star" data-value="1" aria-label="1 z 5" role="radio" aria-checked="false">☆</button>
      <button type="button" class="star" data-value="2" aria-label="2 z 5" role="radio" aria-checked="false">☆</button>
      <button type="button" class="star" data-value="3" aria-label="3 z 5" role="radio" aria-checked="false">☆</button>
      <button type="button" class="star" data-value="4" aria-label="4 z 5" role="radio" aria-checked="false">☆</button>
      <button type="button" class="star" data-value="5" aria-label="5 z 5" role="radio" aria-checked="false">☆</button>
    </div>
    <div id="rating-stats">
      <strong id="rating-avg">Zatím nehodnoceno</strong>
      <span id="rating-count" style="color:#6d6d6d">(0 hodnocení)</span>
      <span id="rating-status"></span>
    </div>
  </div>
</section>

<!-- ===== Kontakt ===== -->
<section class="section" id="kontakt">
  <h2>Kontakt</h2>
  <div class="contact-quick" aria-label="Rychlé kontakty">
    <a class="qi" href="tel:+420733782290">
      <svg viewBox="0 0 24 24" fill="none"><path d="M6 3h4l2 5-3 2a16 16 0 007 7l2-3 5 2v4c0 .6-.4 1-1 1C10.6 21 3 13.4 3 4c0-.6.4-1 1-1z" stroke="#333" stroke-width="1.5"/></svg>
      <span>+420 733 782 290</span>
    </a>
    <a class="qi" href="mailto:pojistitosnadno@gmail.com">
      <svg viewBox="0 0 24 24" fill="none"><path d="M4 6h16a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2z" stroke="#333" stroke-width="1.5"/><path d="M22 8l-10 7L2 8" stroke="#333" stroke-width="1.5"/></svg>
      <span>pojistitosnadno@gmail.com</span>
    </a>
  </div>

  <form class="form" action="https://formspree.io/f/mvgqqpev" method="POST">
    <input type="hidden" name="_redirect" value="dekujeme.html">
    <input type="text" name="Jméno" placeholder="Jméno a příjmení" required>
    <input type="number" name="Věk" placeholder="Váš věk">
    <textarea name="Zpráva" rows="4" placeholder="Co vás zajímá?"></textarea>
    <input type="email" name="Email" placeholder="Váš e‑mail" required>
    <input type="tel" name="Telefon" placeholder="Telefon (9 číslic)" pattern="[0-9]{9}">
    <div class="actions">
      <button class="btn btn--primary" type="submit">Odeslat poptávku</button>
      <button class="btn" type="reset" style="background:#e9e9e4">Vymazat</button>
    </div>
  </form>
</section>

<!-- ===== Footer ===== -->
<footer>
  <div class="footer-wrap">
    <div class="footer-links">
      <a href="ochrana-osobnich-udaju.html">Ochrana osobních údajů</a>
      <a href="cookies.html">Cookies</a>
      <a href="podminky.html">Podmínky</a>
    </div>
    <div class="social">
      <a aria-label="Facebook" href="https://www.facebook.com/pojistitosnadno.cz" target="_blank">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M14 9h3V6h-3c-1.7 0-3 1.3-3 3v3H8v3h3v6h3v-6h3l1-3h-4V9c0-.6.4-1 1-1z" fill="#1c1c1c"/></svg>
      </a>
      <a aria-label="Instagram" href="#" target="_blank">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="3" width="18" height="18" rx="5" stroke="#1c1c1c" stroke-width="1.5"/><circle cx="12" cy="12" r="4.5" stroke="#1c1c1c" stroke-width="1.5"/><circle cx="17.5" cy="6.5" r="1.2" fill="#1c1c1c"/></svg>
      </a>
    </div>
    <div style="color:#666;font-size:.92rem">© 2025 Daniel Verner – PojistiToSnadno.cz</div>
  </div>
</footer>

<!-- ===== Skripty ===== -->
<script>
  const burger = document.getElementById('burger');
  const nav = document.getElementById('nav');

  burger.addEventListener('click', () => {
    const open = burger.getAttribute('aria-expanded') === 'true';
    burger.setAttribute('aria-expanded', String(!open));
    nav.classList.toggle('nav--open');
    document.body.classList.toggle('no-scroll', !open);
  });

  nav.addEventListener('click', e => {
    const a = e.target.closest('a');
    if (a) {
      burger.setAttribute('aria-expanded', 'false');
      nav.classList.remove('nav--open');
      document.body.classList.remove('no-scroll');
    }
  });
</script>

<!-- Rating: Firestore (REST) + lokální fallback -->
<script>
  const FIREBASE = {
    apiKey: "AIzaSyAQ1K5Bb2qv10-EWLvs2S6_lx2nQKdoUao",
    projectId: "pojistitostnadno-2025"
  };

  const $ = s => document.querySelector(s);
  const starsRoot = document.getElementById('stars') || document.querySelector('#hodnoceni .stars');
  const avgEl    = $('#rating-avg');
  const countEl  = $('#rating-count');
  const statusEl = $('#rating-status');

  function decl(n, one, few, many){ return (n===1)?one:((n>=2&&n<=4)?few:many); }
  function paintStars(val){
    starsRoot?.querySelectorAll('[data-value]')?.forEach(el=>{
      const v = Number(el.getAttribute('data-value'));
      el.textContent = v <= val ? '★' : '☆';
      el.setAttribute('aria-checked', String(v === val));
    });
  }
  function setStats(sum,count){
    const avg = count>0 ? sum/count : 0;
    avgEl.textContent   = count ? `${avg.toFixed(1)} / 5` : 'Zatím nehodnoceno';
    countEl.textContent = `(${count} ${decl(count,'hodnocení','hodnocení','hodnocení')})`;
  }

  const LS_VOTED = 'pts_rating_v1_voted';
  const LS_SUM   = 'pts_rating_v1_sum';
  const LS_COUNT = 'pts_rating_v1_count';

  function localGet(){
    const sum = Number(localStorage.getItem(LS_SUM)||0);
    const count = Number(localStorage.getItem(LS_COUNT)||0);
    setStats(sum, count);
    statusEl.textContent = 'Lokální režim (data se nesdílí).';
  }
  function localVote(value){
    if(localStorage.getItem(LS_VOTED)){
      statusEl.textContent = 'Už jste hodnotili na tomto zařízení.';
      return;
    }
    const sum = Number(localStorage.getItem(LS_SUM)||0) + value;
    const count = Number(localStorage.getItem(LS_COUNT)||0) + 1;
    localStorage.setItem(LS_SUM, String(sum));
    localStorage.setItem(LS_COUNT, String(count));
    localStorage.setItem(LS_VOTED,'1');
    setStats(sum, count);
    statusEl.textContent = 'Děkujeme za hodnocení!';
  }

  const BASE = `https://firestore.googleapis.com/v1`;
  const DOC_NAME = `projects/${FIREBASE.projectId}/databases/(default)/documents/ratings/global`;

  async function restGet(){
    const r = await fetch(`${BASE}/${DOC_NAME}?key=${encodeURIComponent(FIREBASE.apiKey)}`);
    if (r.status === 404) return { sum:0, count:0 };
    if (!r.ok) throw new Error(`GET ${r.status}`);
    const j = await r.json();
    const f = j.fields || {};
    const sum   = Number((f.sum?.integerValue ?? f.sum?.doubleValue ?? 0));
    const count = Number((f.count?.integerValue ?? f.count?.doubleValue ?? 0));
    return { sum, count };
  }

  async function restEnsureDoc(){
    const url = `${BASE}/projects/${FIREBASE.projectId}/databases/(default)/documents/ratings?documentId=global&key=${encodeURIComponent(FIREBASE.apiKey)}`;
    const body = { fields: { sum:{integerValue:0}, count:{integerValue:0} } };
    const r = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
    if (!r.ok && r.status !== 409) throw new Error(`CREATE ${r.status}`);
  }

  async function restIncrement(value){
    const url = `${BASE}/projects/${FIREBASE.projectId}/databases/(default)/documents:commit?key=${encodeURIComponent(FIREBASE.apiKey)}`;
    const body = {
      writes: [{
        transform: {
          document: DOC_NAME,
          fieldTransforms: [
            { fieldPath: "sum",   increment: { integerValue: value } },
            { fieldPath: "count", increment: { integerValue: 1 } }
          ]
        }
      }]
    };
    const r = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
    if (!r.ok) throw new Error(`COMMIT ${r.status}`);
  }

  (async ()=>{
    try{
      statusEl.textContent = 'Načítám hodnocení…';
      try { await restEnsureDoc(); } catch(_) {}
      const { sum, count } = await restGet();
      setStats(sum, count);
      statusEl.textContent = '';
    }catch(e){
      console.warn('REST Firestore selhal, přepínám na lokální režim.', e);
      localGet();
    }
  })();

  function handleRate(val){
    paintStars(val);

    if (statusEl.textContent.includes('Lokální režim')) {
      return localVote(val);
    }

    if (localStorage.getItem(LS_VOTED)) {
      statusEl.textContent = 'Už jste hodnotili na tomto zařízení.';
      return;
    }
    statusEl.textContent = 'Ukládám…';
    restIncrement(val).then(async ()=>{
      const { sum, count } = await restGet();
      setStats(sum, count);
      localStorage.setItem(LS_VOTED,'1');
      statusEl.textContent = 'Děkujeme za hodnocení!';
    }).catch(err=>{
      console.error(err);
      statusEl.textContent = 'Nepodařilo se uložit. Zkuste to prosím znovu.';
    });
  }

  starsRoot?.addEventListener('click', e=>{
    const el = e.target.closest('[data-value]');
    if (!el) return;
    handleRate(Number(el.getAttribute('data-value')));
  });
  starsRoot?.addEventListener('keydown', e=>{
    const el = e.target.closest('[data-value]');
    if (!el) return;
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      handleRate(Number(el.getAttribute('data-value')));
    }
  });

  paintStars(0);
</script>

</body>
</html>





